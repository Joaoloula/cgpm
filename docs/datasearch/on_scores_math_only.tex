\documentclass{article}

\usepackage{geometry}
  \geometry{
    a4paper,
    total={170mm,257mm},
    left=30mm,
    right=30mm,
    top=20mm,
}

\usepackage[utf8]{inputenc} % allow utf-8 input
\usepackage[T1]{fontenc}    % use 8-bit T1 fonts
\usepackage{hyperref}       % hyperlinks
\usepackage{url}            % simple URL typesetting
\usepackage{booktabs}       % professional-quality tables
\usepackage{amsfonts}       % blackboard math symbols
\usepackage{nicefrac}       % compact symbols for 1/2, etc.
\usepackage{microtype}      % microtypography

\usepackage[labelfont=bf]{caption}
\usepackage[subrefformat=parens]{subcaption}
\usepackage[usenames,dvipsnames,svgnames]{xcolor}
\usepackage{algorithmicx}
\usepackage{algorithm}
\usepackage[noend]{algpseudocode}
\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{bm}
\usepackage{bbm}
\usepackage{chngcntr}
\usepackage{mdframed}
\usepackage{graphicx}
\usepackage{parskip}
\usepackage{placeins}
\usepackage{soul}
\usepackage{enumerate}
\usepackage{cancel}

% fonts
\renewcommand{\rmdefault}{ptm}
\renewcommand{\sfdefault}{phv}

\newcommand*\Let[2]{\State {#1} $\gets$ {#2}}
\newcommand*\Sample[2]{\State {#1} $\sim$ {#2}}
\algnewcommand{\LineComment}[1]{\State \(\triangleright\) #1}

\DeclareMathOperator{\argmin}{arg\,min}
\DeclareMathOperator{\argmax}{arg\,max}
\DeclareMathOperator{\logsumexp}{logsumexp}

\def\indep{\perp\!\!\!\perp}

\newcommand{\red}[1]{\textcolor{red}{#1}}
\newcommand{\blue}[1]{\textcolor{blue}{#1}}
\newcommand{\set}[1]{\{{#1}\}}

\frenchspacing
\setlength{\floatsep}{5pt plus 1.0pt minus 2.0pt}
\setlength{\textfloatsep}{10pt plus 1.0pt minus 2.0pt}
\setlength{\abovecaptionskip}{2pt plus 0.0pt minus 1.0pt}
% \belowcaptionskip.
\setlength{\abovedisplayskip}{5pt plus 1.0pt minus 2.0pt}
\setlength{\belowdisplayskip}{5pt plus 1.0pt minus 2.0pt}

\newcommand{\algorithmbreak}{%
\vspace{5 pt}%
\noindent\rule{\linewidth}{0.4pt}%
\setcounter{ALG@line}{0}%
}

\newtheoremstyle{break}% name
  {10pt}%Space above
  {10pt}%Space below
  {\itshape}%Body font
  {}%Indent amount
  {\bfseries}% Theorem head font
  {:}%Punctuation after theorem head
  {\newline}%Space after theorem head 2
  {}%Theorem head spec (can be left empty, meaning ‘normal’)
\theoremstyle{break}
\newtheorem{theorem}{Theorem}[section]
\newtheorem{corollary}{Corollary}[theorem]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{definition}{Definition}[section]
\newtheorem{proposition}{Proposition}[section]

\begin{document}
\title{On the relation between data search scores: \\
  Bayes Sets Score, Relevance Score and Posterior Relevance Score}
\author{Leo Casarsa}
\maketitle

\section{Data search scores}

  \newcommand{\mS}{\mathcal{S}}
  \newcommand{\target}{\vec x_t}
  \newcommand{\targetone}{\vec x_a}
  \newcommand{\targettwo}{\vec x_b}
  \newcommand{\queryset}{\set{\vec x_{q_i}}}
  \newcommand{\reals}{\mathbb{R}}
  \newcommand{\Rd}{\mathbb{R}^d}
  \newcommand{\Rdn}{\mathbb{R}^{d \times n}}
  \newcommand{\Rpos}{\mathbb{R}_{\geq 0}}
  \newcommand{\Rdr}{\mathbb{R}^{d \times m}}
  \newcommand{\mD}{\mathcal{D}}
  \newcommand{\mG}{\mathcal{G}}
  \newcommand{\hypers}{\vec \lambda}
  \newcommand{\params}{\vec \theta}
  \newcommand{\yt}{y_t}
  \newcommand{\yi}{y_i}
  \newcommand{\sameyq}{y_{q_1}=\ldots=y_{q_n}}
  \newcommand{\yqset}{y_q^{\star}}
  \newcommand{\rscore}{\mS_{\mG, R}}
  \newcommand{\rscoretq}{\rscore(\target, \queryset)}
  \newcommand{\pscore}{\mS_{\mG, P}}
  \newcommand{\pscoretq}{\pscore(\target, \queryset)}
  \newcommand{\sstats}{\text{T}}
  \newcommand{\crp}{\textsc{CRP}}
  \newcommand{\into}{\rightarrow}

  
    \begin{definition}[Bayesian Sets Score]
      
      \begin{equation}
        \mS_B(\target, \queryset) :=
            \frac {P(\target, \queryset \mid \hypers)}
                {P(\target \mid \hypers) {P(\queryset \mid \hypers)}}
      \end{equation}
      
      \begin{align*}
        P(\vec x \mid \hypers) &= \int P(\vec x \mid \params)
            P(\params \mid \hypers) \, d\params \\
        P(\set{\vec x_i}_{i=1}^n) &= \int \prod_{i=1, \cdots, n} 
            P(\vec x_i \mid \params) P(\params \mid \hypers) \, d\params
      \end{align*}

    \end{definition}

 
    \begin{definition}[Relevance Score]
      \begin{equation}
        \rscoretq := \frac 
            {P(\yt = \yqset \mid \target, \queryset, \sameyq)}
            {P(\yt \neq \yqset \mid \target, \queryset, \sameyq)}
      \end{equation}
    \end{definition}

    \begin{definition}[Posterior Score]    
      \begin{equation}
        \pscore (\target, \queryset) :=
            P(\yt = \yqset \mid \target, \queryset, \sameyq)
      \end{equation}
    \end{definition}

    \begin{theorem}

      \begin{equation}
        \rscoretq = 
            \frac{n}{\alpha} \, \mS_B(\target, \queryset)
      \end{equation}
    \end{theorem}

    \begin{proof}     
      \begin{align}
        \label{eq:rscore}
        \rscore &(\target, \queryset) \\
        & \triangleq P(\yt = \yqset \mid \target, \queryset, \sameyq)
            \mathbin{/} P(\yt \neq \yqset \mid \target, \queryset, \sameyq) \\
        &= \frac {P(\yt = \yqset, \target, \queryset, \sameyq)}
            {P(\target, \queryset, \sameyq)} \bigg{/}
            \frac {P(\yt \neq \yqset, \target, \queryset, \sameyq)}
            {P(\target, \queryset, \sameyq)} \\
        &= \frac {P(\yt = \yqset, \target, \queryset, \sameyq)}
            {P(\yt \neq \yqset, \target, \queryset, \sameyq)}\\
      \end{align}
      
      \begin{enumerate}
      \item $\yt=0,\, \sameyq = 0$ - target and query in the same cluster
      \item $\yt=0,\, \sameyq = 1$ - target and query in distinct clusters
      \end{enumerate}

      \begin{align}
        \rscore &(\target, \queryset) \\
        &= \frac 
            {P(\yt = \sameyq = 0, \target, \queryset)}
            {P(\yt = 0, \sameyq = 1, \target, \queryset)}\\
        &= \frac{P(\yt = \sameyq = 0) \;
            P(\target, \queryset \mid \yt = \sameyq = 0)}
            {P(\yt = 0, \sameyq = 1) \;
            P(\target, \queryset \mid \yt = 0, \sameyq = 1)}
      \end{align}

      \begin{align}
        P(\yt = \sameyq = 0) &= \crp(\yt = \sameyq = 0 \mid \alpha) \\
        &=1 \cdot \frac{1}{\alpha + 1} \cdots 
            \frac{n}{\alpha+n}\\
        &= n! \, \frac{\Gamma(\alpha+1)}{\Gamma(\alpha+n+1)}
      \end{align}

      \begin{align}
        P(\yt = 0, \sameyq = 1) &= \crp(\yt = 0, \sameyq = 1 \mid \alpha) \\
        &=1 \cdot \frac{\alpha}{\alpha + 1} \cdot \frac{1}{\alpha+2} \cdot
            \frac{2}{\alpha+3} \cdots \frac{n-1}{\alpha+n}\\
        &= \alpha \, (n-1)! \, \frac{\Gamma(\alpha+1)}{\Gamma(\alpha+n+1)}
      \end{align}

      \begin{align}
        P(\target, \queryset &\mid \yt = \sameyq = 0) \\
        & = P(\target, \queryset \mid 
            \sstats(\cancelto{\emptyset}{\set{\vec x_i: y_i=0}}), \, \hypers) \\
        & = P(\target, \queryset \mid \hypers)
      \end{align}

      \begin{align}
        P(\target, \queryset &\mid \yt = 0, \sameyq = 1) \\
        & = P(\target \mid \yt=0) \; P(\queryset \mid \sameyq=1) \\
        & = P(\target \mid 
            \sstats(\cancelto{\emptyset}{\set{\vec x_i: y_i=0}}), \, \hypers)
            \; P(\queryset \mid 
            \sstats(\cancelto{\emptyset}{\set{\vec x_i: y_i=1}}), \, \hypers) \\
        & = P(\target \mid \hypers) \; P(\queryset \mid \hypers) \\
      \end{align}

    \begin{align}
      \rscoretq &= 
          \dfrac{n! \, \frac{\Gamma(\alpha+1)}{\Gamma(\alpha+n+1)}\,
          P(\target, \queryset \mid \hypers)}
          {\alpha \, (n-1)! \, \frac{\Gamma(\alpha+1)}{\Gamma(\alpha+n+1)}\,
          P(\target \mid \hypers) \, P(\queryset \mid \hypers)} \\
      & = \frac{n}{\alpha} \, \frac{P(\target, \queryset \mid \hypers)}
          {P(\target \mid \hypers) \, P(\queryset \mid \hypers)} \\
      & =  \frac{n}{\alpha} \; \mS_B(\target, \queryset)
    \end{align} 
    \end{proof}

    \begin{proposition}
      \begin{equation}
        \pscore(\target, \queryset) = \left( 
            1 + \frac{1}{\rscoretq} \right)^{-1}
      \end{equation}
    \end{proposition}

    \begin{proof}
      \begin{align}
        \rscoretq \\
        &\triangleq \frac 
            {P(\yt = \yqset \mid \target, \queryset, \sameyq)}
            {P(\yt \neq \yqset \mid \target, \queryset, \sameyq)}\\
        &= \frac{\pscoretq}{1-\pscoretq}\\
        \text{SOME TEXT} \\
        \frac{1}{\rscoretq} &= \frac{1}{\pscoretq} - 1\\
         1 + \frac{1}{\rscoretq} &= \frac{1}{\pscoretq} \\
        \left(1 + \frac{1}{\rscoretq}\right)^{-1} &= \pscoretq
      \end{align}
    \end{proof}

    \begin{lemma}
      Let $f,g:\Rd \into \Rpos$ be two nonnegative valued functions such that

      \begin{equation}
        f(\vec x) = \left(1 + \frac{1}{g(\vec x)}\right)^{-1}
      \end{equation}

      Then, $f$ and $g$ induce the same ordering on $\Rd$, 

      \begin{equation}
        f(\vec x_1) > f(\vec x_2) \iff g(\vec x_1) > g(\vec x_2), \, 
            \text{for all} \, \vec x_1, \vec x_2 \in \Rd
      \end{equation}
    \end{lemma}
    
    \begin{proof}
      \begin{align}
        f(\vec x_1) > f(\vec x_2) &\iff \left(1 + \frac{1}{g(\vec x_1)}\right)^{-1} > 
            \left(1 + \frac{1}{g(\vec x_2)}\right)^{-1}\\
        &\iff 1 + \frac{1}{g(\vec x_1)} < 1 + \frac{1}{g(\vec x_2)} \\
        &\iff \frac{1}{g(\vec x_1)} < \frac{1}{g(\vec x_2)} \\
        &\iff g(\vec x_1) > g(\vec x_2) \\
      \end{align}
    \end{proof}

    \begin{corollary}
      \begin{equation}
        \rscore(\targetone, \queryset) > \rscore(\targettwo, \queryset) \iff
         \pscore(\targetone, \queryset) > \pscore(\targettwo, \queryset) 
      \end{equation}
    \end{corollary}
\end{document}



%%% Local Variables:
%%% mode: latex
%%% TeX-master: t
%%% End:
